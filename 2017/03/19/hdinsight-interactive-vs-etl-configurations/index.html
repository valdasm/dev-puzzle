<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US" itemscope="" itemtype="http://schema.org/WebSite"> <head> <meta charset="utf-8"/> <meta name="description" itemprop="description" content="Hive has to be tweaked to satisfy interactive queries " /> <meta name="keywords" itemprop="keywords" content="hdinsight, azure, big data, configuration, Hive" /> <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/> <!-- <meta name="google-site-verification" content="asdfasdf" /> --> <meta name="og:site_name" itemprop="name" content="Valdas Maksimavičius"/> <meta name="og:type" content="article" /> <meta name="og:locale" content="en_US" /> <meta name="og:image" content="https://www.valdas.blog/images/2017/03/ambari2.jpg"/><meta name="twitter:image" content="https://www.valdas.blog/images/2017/03/ambari2.jpg"/><meta name="og:image:width" content="1098"/> <meta name="twitter:image:width" content="1098"/><meta name="og:image:height" content="946"/> <meta name="twitter:image:height" content="946"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image:alt" content="Main picture"/> <meta name="twitter:account_id" content="1525926511" /> <meta name="twitter:creator" content="@VMaksimavicius"/> <meta name="twitter:site" content="@VMaksimavicius"/> <meta name="twitter:title" property="og:title" content="HDInsight - Interactive vs ETL configurations"/> <meta name="twitter:description" property="og:description" content="Hive has to be tweaked to satisfy interactive queries "/> <meta name="twitter:url" property="og:url" content="https://www.valdas.blog/2017/03/19/hdinsight-interactive-vs-etl-configurations/"/> <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="valdas.blog" /> <link rel="shortcut icon" href="/favicon.ico?"/> <link rel="apple-touch-icon" href="/favicon.ico?"/> <link rel="alternate" type="application/rss+xml" title="RSS for valdas.blog" href="https://www.valdas.blog/rss.xml"/> <link rel="stylesheet" href="/css/layout.css?"/> <link rel="stylesheet" href="/css/icons.css?"/> <link rel="canonical" href="https://www.valdas.blog/2017/03/19/hdinsight-interactive-vs-etl-configurations/" itemprop="url" /> <!-- <link rel="amphtml" href="https://www.valdas.blog/2017/03/19/hdinsight-interactive-vs-etl-configurations/" /> --> <title>HDInsight - Interactive vs ETL configurations </title> </head> <body> <div class="wrapper"> <aside class="header-toggle unprintable" id="header-toggle" title="Show the menu" onclick="$('#header').show();$('#header-toggle').hide();">&#9776;</aside> <header class="header" id="header"> <div class="face"> <a href="/about-me/"> <img src="https://www.valdas.blog/images/valdas-maksimavicius-192x192.png" class="photo" alt="Valdas Maksimavičius"/> </a> </div> <nav> <ul class="menu social notranslate"> <li><a href="/rss.xml" re="nofollow" title="Subscribe to my RSS feed"><i class="icon icon-rss notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://github.com/valdasm" rel="nofollow" title="My GitHub profile"><i class="icon icon-github notranslate" aria-hidden="true"></i></a></li> <li><a itemprop="sameAs" href="https://www.linkedin.com/in/valdasm" rel="nofollow" title="My LinkedIn profile"><i class="icon icon-linkedin notranslate" aria-hidden="true"></i></a></li> <li><a href="mailto:valdas@maksimavicius.eu" rel="nofollow" title="Email me any time"><i class="icon icon-mail notranslate" aria-hidden="true"></i></a></li> </ul> <ul class="menu"> <li><a href="/" title="Home page">Home</a></li> <li><a href="/best/" title="Recommended reading">Recommended</a></li> <li><a href="/archive/" title="All archives">Archive</a></li> <li><a href="/notes/" title="Notes">Notes</a></li> <!-- <li><a href="/talks/" title="Public speaking, presentations">Talks</a></li> --> <li><a href="http://eepurl.com/dcCxAD" target="_blank" title="Subscribe">Subscribe</a></li> <li><a href="/about-me/" title="About me">About</a></li> </ul> </nav> </header> </div> <section itemscope="" itemtype="http://schema.org/BlogPosting"> <div itemprop="dateModified" content="2017-03-19T00:00:00+00:00"></div> <div itemprop="image" itemscope="" itemtype="http://schema.org/ImageObject"> <meta itemprop="url" content="https://www.valdas.blog/images/valdas-maksimavicius-1400x1400.png"/> </div> <div itemscope="" itemprop="publisher" itemtype="http://schema.org/Organization"> <meta itemprop="name" content="Valdas' Blog"/> <div itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject"> <meta itemprop="url" content="https://www.valdas.blog/images/valdas-maksimavicius-192x192.png"/> <meta itemprop="height" content="192"/> <meta itemprop="width" content="192"/> </div> </div> <div class="wrapper"> <header> <h1 itemprop="name headline mainEntityOfPage">HDInsight - Interactive vs ETL configurations</h1> <ul class="subline"> <li> <time itemprop="datePublished" datetime="2017-03-19T00:00:00+00:00"> 19 March 2017 </time> </li> <li class="printable" itemscope="" itemprop="author" itemtype="http://schema.org/Person"> <span itemprop="name">Valdas Maksimavičius</span> </li> <!-- <li class="unprintable"> <i class="icon icon-comments"></i> <a href="https://www.valdas.blog/2017/03/19/hdinsight-interactive-vs-etl-configurations/#disqus_thread" itemprop="discussionUrl">comments</a> </li> --> </ul> </header> <main> <article class="main" itemprop="articleBody"> <div > <p>HDInsight allows users to run data transformation and interactive queries on different types of data. Interactive Hive (Hive on LLAP) is still in preview and as a result not available in Europe, old good Hive has to be tweaked to satisfy interactive queries.<!--more--></p> <p>In HDInsight data is stored separately and there can be many HDInsight clusters on the same storage accounts. One use case is to have a separate cluster for Data Scientists (interactive queries, data exploration) and another one for ETL jobs. The clusters can run independently, but preferably on different time slots (Blob Storage throughput limitations).</p> <h4 id="use-cases">USE CASES</h4> <p><strong>Interactive</strong></p> <ul> <li>Common patterns: short running jobs over refined data</li> <li>Main problems: how to use BI tools, how to utilize produced datasets</li> <li>Optimization: as in ETL + use different setup than ETL cluster (see below)</li> </ul> <p><strong>ETL</strong></p> <ul> <li>Common patterns: fire and forget, long running jobs, full table scans</li> <li>Main problems: how to schedule, make operationale, cost based optimizations</li> <li>Optimization: tweak joins, mappers, reducers, memory settings, etc. all you can find</li> </ul> <h4 id="cluster-settings">CLUSTER SETTINGS</h4> <p>(You can change those settings in Ambari UI/Hive/Configuration or change corresponding configuration files)</p> <figure class="jb_picture"><img class="img-responsive" itemprop="image" alt="Main picture" src="/images/2017/03/ambari2.jpg" /></figure> <p><strong>Interactive</strong></p> <ul> <li>hive.execution.engine = tez;</li> <li>hive.server2.tez.initialize.default.sessions = true</li> <li>hive.server2.tez.default.queues = default</li> <li>hive.server2.tez.sessions.per.default.queue = max concurrent queries</li> <li>hive.prewarm.enabled = true</li> <li>hive.prewarm.numcontainers 1-5</li> <li>tez.am.session.min.held-containers 1-5</li> </ul> <p><strong>ETL</strong></p> <ul> <li>hive.execution.engine = tez; (Rebuild index requriesmr)</li> <li>hive.server2.tez.initialize.default.sessions = false</li> <li>hive.server2.tez.default.queues = default</li> <li>hive.server2.tez.sessions.per.default.queue = 1</li> <li>hive.prewarm.enabled = false</li> <li>hive.prewarm.numcontainers = 0</li> <li>tez.am.session.min.held-containers = 0</li> </ul> <h4 id="join-strategy">JOIN STRATEGY</h4> <p><strong>Shuffle (default)</strong></p> <ul> <li>Slow, but works everytime <strong>Map (broadcast)</strong></li> <li>Very fast, but limited</li> <li>One table has to fit in memory</li> <li>Understand Optimize Auto Join Conversion</li> <li>Default size for in-memory table is 10MB</li> <li>For star schemas consider loading dimension tables into memory</li> <li>In case of many joins, n-1 tables should fit in memory <strong>Bucket</strong></li> <li>Very efficient, but difficult to setup</li> <li>Requries both tables to be bucketed and sorted on the same column</li> </ul> <h4 id="hive-execution">HIVE EXECUTION</h4> <p>(WebHCat vs HiveServer2)</p> <ul> <li>HiveServer2 starts queries faster</li> <li>WebHCar has more detailed history</li> <li>HiveServer2 is synchronous while WebHCat is asynchronous</li> <li>In Visual Studio HiveServer2 is called “Interactive”while WebHCat is called “Batch”</li> </ul> <h4 id="execution-engine-optimization">EXECUTION ENGINE OPTIMIZATION</h4> <table> <tbody> <tr> <td><strong>Type</strong></td> <td><strong>Recommended</strong></td> <td><strong>HDI Default</strong></td> </tr> <tr> <td>Joins</td> <td>Bucket join/Sort Merge join</td> <td>Shuffle</td> </tr> <tr> <td>hive.auto.convert.join.noconditionaltask.size</td> <td>1/3 of -Xmx value</td> <td>Auto-Tuned</td> </tr> <tr> <td>tez.grouping.min-size</td> <td>Decrease for better latency; Increase for more throughput</td> <td>16777216</td> </tr> <tr> <td>tez.grouping.max-size</td> <td>Decrease for better latency; Increase for more throughput</td> <td>1073741824</td> </tr> <tr> <td>hive.exec.reducers.bytes.per.reducer</td> <td>Decrease if reducers are the bottleneck</td> <td>256MB</td> </tr> <tr> <td>hive.cbo.enable</td> <td>true but need to rewrite tables</td> <td>True</td> </tr> <tr> <td>tez.am.resource.memory.mb</td> <td>4GB upper bound for most</td> <td>Auto-Tuned</td> </tr> <tr> <td>tez.session.am.dag.submit.timeout.secs</td> <td>300+</td> <td>300</td> </tr> <tr> <td>tez.am.container.idle.release-timeout-min.millis</td> <td>20000+</td> <td>10000</td> </tr> <tr> <td>tez.am.container.idle.release-timeout-max.millis</td> <td>40000+</td> <td>20000</td> </tr> </tbody> </table> <p><strong>How to know what settings are used during TEZ query execution?</strong> Ambari/Tez view/«Query application ID»/ App Configuration/</p> <p>More info: <a href="https://channel9.msdn.com/Events/Machine-Learning-and-Data-Sciences-Conference/Data-Science-Summit-2016/MSDSS25">HDInsight performance</a> <a href="https://hadoopoopadoop.com/2015/09/20/shifting-to-hive-part-ii-a-catalog-of-best-practices-and-optimization/comment-page-1/">Hive optimization</a> <a href="https://snippetessay.wordpress.com/2015/07/25/hive-optimizations-with-indexes-bloom-filters-and-statistics/">Hive optimization #2</a> <a href="http://henning.kropponline.de/2016/10/09/hive-join-strategies/">Hive join strategies</a> <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+JoinOptimization">Hive joins</a></p> </div> </article> </main> <header> <p class="unprintable"><a href='/tag/software/' class='tag notranslate'>software</a></p> <nav class="buttons notranslate"> <a href="http://www.facebook.com/sharer/sharer.php?u=https://www.valdas.blog/2017/03/19/hdinsight-interactive-vs-etl-configurations/" title="Share on Facebook" class="button" rel="nofollow"> <span class="count count-facebook">0</span> <i class="icon icon-facebook notranslate" aria-hidden="true"></i> </a> <a href="https://www.linkedin.com/cws/share?url=https://www.valdas.blog/2017/03/19/hdinsight-interactive-vs-etl-configurations/" title="Share on LinkedIn" class="button" rel="nofollow"> <span class="count count-linkedin">0</span> <i class="icon icon-linkedin notranslate" aria-hidden="true"></i> </a> <a href="http://reddit.com/submit?url=https://www.valdas.blog/2017/03/19/hdinsight-interactive-vs-etl-configurations/%3F2017-12&amp;title=HDInsight+-+Interactive+vs+ETL+configurations" title="Share on Reddit" class="button" rel="nofollow"> <span class="count count-reddit">0</span> <i class="icon icon-reddit notranslate" aria-hidden="true"></i> </a> </nav> </header> </div> <!-- --> <div class="disqus" role="complementary"> <div id="disqus_thread" class="disqus-thread"></div> <script> var disqus_config = function () { this.page.url = document.location.href.split('?')[0].split('#')[0]; this.page.identifier = this.page.url.split('.html')[0]; }; (function() { var d = document, s = d.createElement('script'); s.src = '//valdas-blog.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript> <div> <p class="red"> JavaScript is disabled in your browser, that's why you can't see comments under this post. </p> </div> </noscript> </div> </section> <div class="wrapper"> <footer class="footer"> <p> &copy; <span itemscope="" itemprop="copyrightHolder" itemtype="http://schema.org/Person"> <span itemprop="name">Valdas Maksimavičius</span> </span> <span itemprop="copyrightYear">2018</span> </p> </footer> </div> <script src="//code.jquery.com/jquery-1.9.0.min.js"></script> <script src="/js/all.js?"></script> <script>var disqus_shortname = 'valdas-blog';</script> <script id="dsq-count-scr" src="//valdas-blog.disqus.com/count.js" async="async"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-53567712-3', 'auto'); ga('send', 'pageview'); </script> <script language="javascript" type="text/javascript"> Cd=document;Cr="&"+Math.random();Cp="&s=1"; Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1"; Cp+="&t="+(new Date()).getTimezoneOffset(); if(self!=top)Cp+="&f=1"; </script> <script language="javascript1.1" type="text/javascript"> if(navigator.javaEnabled())Cp+="&j=1"; </script> <script language="javascript1.2" type="text/javascript"> if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+ screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth); </script> </body> </html>
